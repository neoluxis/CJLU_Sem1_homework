C51 COMPILER V9.60.0.0   MAIN                                                              10/29/2022 20:23:11 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\Main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Main
                    -.lst) TABS(2) OBJECT(.\Objects\Main.obj)

line level    source

   1          #include "REG52.H"
   2          
   3          //通用
   4          #define uchar unsigned char
   5          #define uint unsigned int
   6          #define boolean int
   7          #define true 1
   8          #define false 0
   9          
  10          sbit led_1 = P1 ^ 0;
  11          sbit led_2 = P1 ^ 1;
  12          sbit led_3 = P1 ^ 2;
  13          sbit led_4 = P1 ^ 3;
  14          sbit beep = P1 ^ 6;
  15          sbit alarm = P1 ^ 7;
  16          sbit xw = P2 ^ 7;
  17          sbit xd = P2 ^ 6;
  18          sbit start_key = P3 ^ 0;
  19          
  20          boolean isCorrectPsw = false;
  21          int correctPsw[] = {1, 0, 2, 4};
  22          int tens_digit = 3, single_digit = 0, decile = 0;
  23          
  24          void delayMillis(int millis)
  25          {
  26   1          int i, j;
  27   1          for (i = 0; i < millis; i++)
  28   1          {
  29   2              for (j = 0; j < 120; j++)
  30   2              {
  31   3              }
  32   2          }
  33   1      }
  34          
  35          uchar code numbers[] = {
  36              0x3F, // "0"
  37              0x06, // "1"
  38              0x5B, // "2"
  39              0x4F, // "3"
  40              0x66, // "4"
  41              0x6D, // "5"
  42              0x7D, // "6"
  43              0x07, // "7"
  44              0x7F, // "8"
  45              0x6F, // "9"
  46              0x00, // "all down"
  47          };
  48          
  49          uchar wei_index = 0;    //这三个变量没用
  50          uchar wei_monetary = 0; //这三个变量没用
  51          uchar num_index = 0;    //这三个变量没用
  52          
  53          typedef struct
  54          {
C51 COMPILER V9.60.0.0   MAIN                                                              10/29/2022 20:23:11 PAGE 2   

  55              uchar wei;
  56              uchar duan;
  57          } wein;
  58          
  59          wein shumaguan[] = {
  60              {0x7f, 0x00},
  61              {0xbf, 0x00},
  62              {0xdf, 0x00},
  63              {0xef, 0x00},
  64              {0xf7, 0x00},
  65              {0xfb, 0x00},
  66              {0xfd, 0x00},
  67              {0xfe, 0x00},
  68          };
  69          
  70          void set_Time(int ten, int single, int decile)
  71          {
  72   1          shumaguan[7].duan = numbers[ten];
  73   1          shumaguan[6].duan = numbers[single] | 0x80;
  74   1          shumaguan[5].duan = numbers[decile];
  75   1      }
  76          
  77          void display()
  78          {
  79   1          int c = 0;
  80   1          for (c = 0; c < 8; c++)
  81   1          {
  82   2              xw = 1;
  83   2              P0 = shumaguan[c].wei;
  84   2              xw = 0;
  85   2              xd = 1;
  86   2              P0 = shumaguan[c].duan;
  87   2              xd = 0;
  88   2              delayMillis(2);
  89   2          }
  90   1      }
  91          
  92          // 键盘
  93          unsigned char keyVal = 100;
  94          /*  Key Buttons
  95              -------------------------
  96              |  1  |  2  |  3  |crack|
  97              -------------------------
  98              |  4  |  5  |  6  | del |
  99              -------------------------
 100              |  7  |  8  |  9  |     |
 101              -------------------------
 102              |     |  0  |     | cls |
 103              -------------------------
 104              |  On |     |     |     |
 105              -------------------------*/
 106          void keyScan()
 107          {
 108   1          P3 = 0xF0;
 109   1          if (P3 != 0xF0)
 110   1          {
 111   2              delayMillis(2);
 112   2              if (P3 != 0xF0) // 检测列
 113   2              {
 114   3                  switch (P3)
 115   3                  {
 116   4                  case 0xe0:
C51 COMPILER V9.60.0.0   MAIN                                                              10/29/2022 20:23:11 PAGE 3   

 117   4                      keyVal = 0;
 118   4                      break;
 119   4                  case 0xd0:
 120   4                      keyVal = 1;
 121   4                      break;
 122   4                  case 0xb0:
 123   4                      keyVal = 2;
 124   4                      break;
 125   4                  case 0x70:
 126   4                      keyVal = 3;
 127   4                      break;
 128   4                  }
 129   3                  P3 = 0x0f; //检测行
 130   3                  switch (P3)
 131   3                  {
 132   4                  case 0x0e:
 133   4                      keyVal = keyVal;
 134   4                      break;
 135   4                  case 0x0d:
 136   4                      keyVal = keyVal + 4;
 137   4                      break;
 138   4                  case 0x0b:
 139   4                      keyVal = keyVal + 8;
 140   4                      break;
 141   4                  case 0x07:
 142   4                      keyVal = keyVal + 12;
 143   4                      break;
 144   4                  }
 145   3                  while (P3 != 0x0f)
 146   3                      ;
 147   3              }
 148   2          }
 149   1          P3 = 0xff; // 检测独立键盘
 150   1          if (P3 != 0xff)
 151   1          {
 152   2              delayMillis(2);
 153   2              if (P3 != 0xff)
 154   2              {
 155   3                  switch (P3)
 156   3                  {
 157   4                  case 0xfe:
 158   4                      keyVal = 16;
 159   4                      break;
 160   4                  case 0xfd:
 161   4                      keyVal = 17;
 162   4                      break;
 163   4                  case 0xfb:
 164   4                      keyVal = 18;
 165   4                      break;
 166   4                  case 0xf7:
 167   4                      keyVal = 19;
 168   4                      break;
 169   4                  }
 170   3                  while (P3 != 0xff)
 171   3                      ;
 172   3              }
 173   2          }
 174   1      }
 175          
 176          int genInput()
 177          {
 178   1          int ret = 0;
C51 COMPILER V9.60.0.0   MAIN                                                              10/29/2022 20:23:11 PAGE 4   

 179   1          keyScan();
 180   1      
 181   1          if (keyVal == 0)
 182   1          {
 183   2              ret = 1;
 184   2          }
 185   1          else if (keyVal == 1)
 186   1          {
 187   2              ret = 2;
 188   2          }
 189   1          else if (keyVal == 2)
 190   1          {
 191   2              ret = 3;
 192   2          }
 193   1          else if (keyVal == 4)
 194   1          {
 195   2              ret = 4;
 196   2          }
 197   1          else if (keyVal == 5)
 198   1          {
 199   2              ret = 5;
 200   2          }
 201   1          else if (keyVal == 6)
 202   1          {
 203   2              ret = 6;
 204   2          }
 205   1          else if (keyVal == 8)
 206   1          {
 207   2              ret = 7;
 208   2          }
 209   1          else if (keyVal == 9)
 210   1          {
 211   2              ret = 8;
 212   2          }
 213   1          else if (keyVal == 10)
 214   1          {
 215   2              ret = 9;
 216   2          }
 217   1          else if (keyVal == 13)
 218   1          {
 219   2              ret = 0;
 220   2          }
 221   1          else if (keyVal == 15)
 222   1          {
 223   2              ret = 11; // cls
 224   2          }
 225   1          else if (keyVal == 100)
 226   1          {
 227   2              ret = 10; // no input
 228   2          }
 229   1          return ret;
 230   1      }
 231          
 232          int psw[4];
 233          void checkPSW()
 234          {
 235   1          int i;
 236   1          for (i = 0; i < 4; i++)
 237   1          {
 238   2              if (psw[i] != correctPsw[i])
 239   2              {
 240   3                  isCorrectPsw = false;
C51 COMPILER V9.60.0.0   MAIN                                                              10/29/2022 20:23:11 PAGE 5   

 241   3                  return;
 242   3              }
 243   2          }
 244   1          isCorrectPsw = true;
 245   1      }
 246          
 247          void set_PSW()
 248          {
 249   1          int ii, inin;
 250   1          for (ii = 0; ii < 4; ii++)
 251   1          {
 252   2              P3 = 0xff;
 253   2              inin = genInput();
 254   2              if (inin >= 0 && inin <= 9)
 255   2              {
 256   3                  psw[ii] = inin;
 257   3                  shumaguan[3 - ii].duan = numbers[inin];
 258   3              }
 259   2              else if (inin == 11)
 260   2              {
 261   3                  shumaguan[0].duan = 0xff;
 262   3                  shumaguan[1].duan = 0xff;
 263   3                  shumaguan[2].duan = 0xff;
 264   3                  shumaguan[3].duan = 0xff;
 265   3                  ii = -1;
 266   3              }
 267   2          }
 268   1      }
 269          
 270          // timer
 271          
 272          void timer0Init()
 273          {
 274   1          TMOD = 0x01;
 275   1          TH0 = 0x00;
 276   1          TL0 = 0x5c;
 277   1          TF0 = 0;
 278   1          TR0 = 1;
 279   1          ET0 = 1;
 280   1          EA = 1;
 281   1      }
 282          
 283          void time0() interrupt 1
 284          {
 285   1          TH0 = 0x00;
 286   1          TL0 = 0x5c;
 287   1      
 288   1          if (decile == 0)
 289   1          {
 290   2              decile = 9;
 291   2              if (single_digit == 0)
 292   2              {
 293   3                  single_digit = 9;
 294   3                  if (tens_digit == 0)
 295   3                  {
 296   4                      tens_digit = 2;
 297   4                  }
 298   3                  else
 299   3                  {
 300   4                      tens_digit--;
 301   4                  }
 302   3              }
C51 COMPILER V9.60.0.0   MAIN                                                              10/29/2022 20:23:11 PAGE 6   

 303   2              else
 304   2              {
 305   3                  single_digit--;
 306   3              }
 307   2          }
 308   1          else
 309   1          {
 310   2              decile--;
 311   2          }
 312   1      
 313   1          if (tens_digit == 0 && single_digit == 0 && decile == 0)
 314   1          {
 315   2              alarm = 0;
 316   2              delayMillis(300);
 317   2              alarm = 1;
 318   2          }
 319   1          else
 320   1          {
 321   2              alarm = 1;
 322   2          }
 323   1      
 324   1          set_Time(tens_digit, single_digit, decile);
 325   1      }
 326          
 327          void onStart()
 328          {
 329   1          int fu = 0;
 330   1          start_key = 1;
 331   1          while (1)
 332   1          {
 333   2              for (fu = 0; fu < 8; fu++)
 334   2              {
 335   3                  xw = 1;
 336   3                  P0 = shumaguan[fu].wei;
 337   3                  xw = 0;
 338   3                  xd = 1;
 339   3                  P0 = 0x40;
 340   3                  xd = 0;
 341   3                  delayMillis(2);
 342   3              }
 343   2              if (!start_key)
 344   2              {
 345   3                  delayMillis(10);
 346   3                  if (!start_key)
 347   3                  {
 348   4                      break;
 349   4                  }
 350   3              }
 351   2          }
 352   1      }
 353          
 354          void main()
 355          {
 356   1          int ii = 0, inin;
 357   1          onStart();
 358   1          timer0Init();
 359   1          while (1)
 360   1          {
 361   2              P3 = 0xff;
 362   2              inin = genInput();
 363   2              if (inin >= 0 && inin <= 9)
 364   2              {
C51 COMPILER V9.60.0.0   MAIN                                                              10/29/2022 20:23:11 PAGE 7   

 365   3                  psw[ii] = inin;
 366   3                  shumaguan[3 - ii].duan = numbers[inin];
 367   3                  ii++;
 368   3                  inin = 0;
 369   3              }
 370   2              else if (inin == 11)
 371   2              {
 372   3                  shumaguan[0].duan = 0xff;
 373   3                  shumaguan[1].duan = 0xff;
 374   3                  shumaguan[2].duan = 0xff;
 375   3                  shumaguan[3].duan = 0xff;
 376   3                  ii = -1;
 377   3              }
 378   2              else
 379   2              {
 380   3                  inin = 0;
 381   3              }
 382   2              if (ii == 4)
 383   2              {
 384   3                  checkPSW();
 385   3                  ii = 0;
 386   3                  if (isCorrectPsw)
 387   3                  {
 388   4                      ET0 = 0;
 389   4                      ET1 = 1;
 390   4                  }
 391   3                  else
 392   3                  {
 393   4                      ET0 = 0;
 394   4                      single_digit -= 2;
 395   4                      ET0 = 1;
 396   4                  }
 397   3              }
 398   2      
 399   2              display();
 400   2          }
 401   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1032    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     44       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
