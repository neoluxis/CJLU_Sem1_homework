C51 COMPILER V9.60.0.0   MAIN                                                              11/14/2022 17:09:37 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\Main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Main
                    -.lst) TABS(2) OBJECT(.\Objects\Main.obj)

line level    source

   1          
   2          #include <reg52.h> 
   3          #include <intrins.h>
   4          typedef unsigned char uchar; 
   5          
   6          uchar totaltime, dutyfactor, direct;
   7          
   8          sbit du = P2 ^ 6;                                         
   9          sbit we = P2 ^ 7;                                         
  10          unsigned char code distab[8] = {0xfe, 0xfd, 0xfb, 0xf7, 0xef, 0xdF, 0xbF, 0x7F};          
  11          char code tabel[] = {0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D, 0x7D, 0x07, 0x7F, 0x6F, 0x00, 0xff, 0xb6}; 
  12          sbit key_s2 = P3 ^ 0;
  13          sbit key_s3 = P3 ^ 1;
  14          sbit key_s4 = P3 ^ 2;
  15          sbit key_s5 = P3 ^ 3;
  16          sbit LED = P1;      
  17          void InterruptInit(); 
  18          void InterruptInit1();
  19          void Time0();    
  20          void breatheLED(); int m;
  21          int f = 1;
  22          int t[4] = {70, 100, 122, 141};
  23          
  24          int a = 0;
  25          int time = 0, timea = 0, time2 = 0;
  26          void delay(int z)
  27          {
  28   1        int x, y;
  29   1        for (x = z; x > 0; x--)
  30   1          for (y = 114; y > 0; y--)
  31   1            ;
  32   1      }
  33          void display(int time) 
  34          {
  35   1        char g;
  36   1      
  37   1        g = time % 10;
  38   1      
  39   1        du = 0;
  40   1        P0 = tabel[g];
  41   1        du = 1;
  42   1        du = 0;
  43   1      
  44   1        we = 0;
  45   1        P0 = distab[0];
  46   1        we = 1;
  47   1        we = 0;
  48   1      }
  49          
  50          void main()
  51          {
  52   1        InterruptInit();
  53   1        InterruptInit1();
  54   1        m = 0xfe;
C51 COMPILER V9.60.0.0   MAIN                                                              11/14/2022 17:09:37 PAGE 2   

  55   1        timea = 0;
  56   1        time2 = 0;
  57   1      
  58   1        while (1)
  59   1        {
  60   2          breatheLED();
  61   2          display(a + 1);
  62   2          if (key_s2 == 0)
  63   2          {
  64   3            f = 1;
  65   3          }
  66   2          if (key_s3 == 0)
  67   2          {
  68   3            f = -1;
  69   3          }
  70   2      
  71   2          if (key_s5 == 0)
  72   2          {
  73   3            delay(1);
  74   3            if (key_s5 == 0)
  75   3            {
  76   4              a = a + 1;
  77   4              while (!key_s5)
  78   4                ;
  79   4            }
  80   3          }
  81   2          if (key_s4 == 0)
  82   2          {
  83   3            delay(1);
  84   3            if (key_s4 == 0)
  85   3            {
  86   4              a = a - 1;
  87   4              while (!key_s4)
  88   4                ;
  89   4            }
  90   3          }
  91   2          if (a < 0)
  92   2          {
  93   3            a = 0;
  94   3          }
  95   2          else if (a > 3)
  96   2          {
  97   3            a = 3;
  98   3          }
  99   2      
 100   2        
 101   2        }
 102   1      }
 103          
 104          
 105          void InterruptInit()
 106          {
 107   1        TMOD &= 0x00;
 108   1        TMOD |= 0x11;
 109   1      
 110   1      
 111   1        TH0 = 0xff; 
 112   1        TL0 = 0xa3; 
 113   1      
 114   1        ET0 = 1; 
 115   1      
 116   1        EA = 1; 
C51 COMPILER V9.60.0.0   MAIN                                                              11/14/2022 17:09:37 PAGE 3   

 117   1      
 118   1        TR0 = 1; 
 119   1      }
 120          
 121          void InterruptInit1()
 122          
 123          {
 124   1        TMOD &= 0x00; 
 125   1        TMOD |= 0x11; 
 126   1      
 127   1        //初值
 128   1      
 129   1        TH1 = 0x4b; 
 130   1        TL1 = 0xfd; 
 131   1      
 132   1        ET1 = 1; 
 133   1        EA = 1;  
 134   1        TR1 = 1; 
 135   1      }
 136          
 137          
 138          void Time0() interrupt 1
 139          {
 140   1        
 141   1        TH0 = 0xff; 
 142   1        TL0 = 0xa3;
 143   1      
 144   1        totaltime++;
 145   1        time++;
 146   1      }
 147          
 148          void Time1() interrupt 3
 149          {
 150   1        
 151   1        TH1 = 0x4b; 
 152   1        TL1 = 0xfd;
 153   1      
 154   1        timea++; 
 155   1      }
 156          
 157          void breatheLED()
 158          {
 159   1        if (totaltime >= t[a])
 160   1        {      
 161   2          totaltime = 0; 
 162   2      
 163   2          
 164   2          if (direct == 0)
 165   2          {         
 166   3            dutyfactor++; 
 167   3          }
 168   2          else if (direct == 1)
 169   2          {         
 170   3            dutyfactor--; 
 171   3          }
 172   2        }
 173   1      
 174   1        if (dutyfactor <= 0)
 175   1        {     
 176   2          direct = 0; 
 177   2        }
 178   1        else if (dutyfactor >= t[a])
C51 COMPILER V9.60.0.0   MAIN                                                              11/14/2022 17:09:37 PAGE 4   

 179   1        {     
 180   2          direct = 1;
 181   2        }
 182   1      
 183   1        if (totaltime < dutyfactor)
 184   1        {     
 185   2          P1 = m; 
 186   2        }
 187   1        else
 188   1        {
 189   2          P1 = 0xff; 
 190   2        }
 191   1      
 192   1      
 193   1        if (timea == 22)
 194   1        {
 195   2          time2++;
 196   2          timea = 0;
 197   2        }
 198   1      
 199   1        if (time2 == a + 1)
 200   1        {
 201   2          m = _crol_(m, f);
 202   2          time2 = 0;
 203   2          totaltime = 0;
 204   2          direct = 0;
 205   2          dutyfactor = 0;
 206   2        }
 207   1      
 208   1        if (m == 0x7f)
 209   1        {
 210   2          f = -1;
 211   2        }
 212   1        else if (m == 0xfe)
 213   1        {
 214   2          f = 1;
 215   2        }
 216   1      
 217   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    487    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
